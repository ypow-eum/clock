<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <!-- ëª¨ë°”ì¼ ìµœì í™” ë° ì „ì²´í™”ë©´ ì§€ì› -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#000000" />
    <!-- iOS / Android ì•± ëª¨ë“œ ì§€ì› -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="manifest" href="manifest.json" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <title>Mobile Clock</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        background-color: #000000;
      }

      body {
        background-color: #000000;
        color: #ffffff;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        height: 100dvh;
        overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
      }

      .clock-container {
        text-align: center;
      }

      /* ì‹œê³„ ìˆ«ì ìŠ¤íƒ€ì¼ */
      .time {
        font-size: min(30vw, 200px);
        font-weight: 800;
        line-height: 1;
        letter-spacing: -0.05em;
        font-variant-numeric: tabular-nums; /* ë“±í­ ìˆ«ì */
      }

      .blink {
        font-size: 90px;
        border-radius: 50%;
        padding: 0px 15px 0px 5px;
        position: relative;
        opacity: 0.5;
        top: -25px;
      }

      /* ì´ˆ í‘œì‹œ (ì•½ê°„ ì‘ê²Œ) */
      .seconds {
        font-size: min(12vw, 70px);
        font-weight: 600;
        color: #888888;
        margin-left: 15px;
      }

      /* í•˜ë‹¨ ì •ë³´ í•œ ì¤„ ì •ë ¬ */
      .info-row {
        margin-top: 20px;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 15px; /* ê° ìš”ì†Œ ì‚¬ì´ ê°„ê²© */
      }

      /* ë‚ ì§œ ìŠ¤íƒ€ì¼ */
      .date {
        font-size: min(5vw, 25px);
        color: #b0b0b0;
        font-weight: 500;
      }

      /* ë‚ ì”¨ ìŠ¤íƒ€ì¼ */
      .weather {
        font-size: min(5vw, 25px);
        color: #dddddd;
        font-weight: 400;
        display: none; /* ë°ì´í„° ì˜¤ê¸° ì „ ìˆ¨ê¹€ */
      }

      /* ë¯¸ì„¸ë¨¼ì§€ ìŠ¤íƒ€ì¼ */
      .aqi {
        font-size: min(4vw, 20px);
        color: #aaaaaa;
        font-weight: 400;
        display: none; /* ë°ì´í„° ì˜¤ê¸° ì „ ìˆ¨ê¹€ */
      }

      /* ë¡œë”© ë° ìƒíƒœ í…ìŠ¤íŠ¸ìš© */
      .status {
        margin-top: 15px;
        font-size: 15px;
        color: #666666;
      }

      .message {
        position: absolute;
        top: 15px;
        width: 100vw;
        text-align: center;
        font-size: min(4vw, 18px);
        color: #ffcc00; /* í™©ê¸ˆë¹› ë…¸ë€ìƒ‰ */
        font-weight: 500;
        opacity: 0.9;
        cursor: pointer;
      }

      /* ì–¸ì–´ ì „í™˜ ë²„íŠ¼ (ìš°í•˜ë‹¨ ê³ ì •) */
      .lang-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        font-size: 24px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background 0.3s;
      }
      .lang-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body>
    <!-- ìƒë‹¨ ë©”ì‹œì§€ (ëˆ„ë¥´ë©´ ëœë¤ ê°±ì‹ ) -->
    <div class="message" onclick="updateQuote()" title="ëˆŒëŸ¬ë³´ì„¸ìš”!"></div>
    <div class="clock-container">
      <!-- ì‹œê°„ í‘œì‹œë¶€ -->
      <div
        class="time"
        style="cursor: pointer"
        title="ëˆ„ë¥´ë©´ 12/24ì‹œê°„ì œ ì „í™˜"
        onclick="toggleTimeFormat()"
      >
        <span id="hours">00</span><span class="blink">:</span
        ><span id="minutes">00</span
        ><span class="seconds" id="seconds">00</span>
      </div>
      <!-- ë‚ ì§œ/ë‚ ì”¨/ë¯¸ì„¸ë¨¼ì§€ í•œ ì¤„ í‘œì‹œë¶€ -->
      <div class="info-row">
        <!-- ë‚ ì§œ í‘œì‹œë¶€ -->
        <div class="date" id="dateDisplay">2026ë…„ 01ì›” 01ì¼ (ì›”)</div>
      </div>
      <div class="info-row">
        <!-- ë‚ ì”¨ í‘œì‹œë¶€ -->
        <div class="weather" id="weatherDisplay"></div>
        <!-- ë¯¸ì„¸ë¨¼ì§€ í‘œì‹œë¶€ -->
        <div class="aqi" id="aqiDisplay"></div>
      </div>
      <div class="status" id="statusDisplay">ë¡œë”© ì¤‘...</div>

      <!-- í™”ë©´ ì „í™˜ ì•„ì´ì½˜ -->
      <button
        class="lang-btn"
        onclick="toggleLang()"
        title="í•œ/ì˜/ìˆ¨ê¹€ ëª¨ë“œ ì „í™˜"
      >
        ğŸŒ
      </button>
    </div>

    <script>
      // 0: í•œê¸€, 1: ì˜ë¬¸, 2: ì•ˆë³´ì„
      var langMode = 0;
      var is12Hour = true; // true: 12ì‹œê°„ì œ, false: 24ì‹œê°„ì œ
      var weatherData = null;
      var aqiData = null;

      function renderWeather() {
        var el = document.getElementById("weatherDisplay");
        var statusEl = document.getElementById("statusDisplay");

        if (langMode === 2) {
          el.style.display = "none";
          statusEl.textContent = "";
          return;
        }

        if (!weatherData) {
          statusEl.textContent =
            langMode === 0
              ? "ë‚ ì”¨ ì •ë³´ë¥¼ ì½ì–´ì˜¤ëŠ” ì¤‘..."
              : "Loading weather...";
          el.style.display = "none";
          return;
        }
        if (weatherData.error) {
          statusEl.textContent =
            langMode === 0 ? weatherData.error.ko : weatherData.error.en;
          el.style.display = "none";
          return;
        }

        el.textContent =
          weatherData.current.icon + " " + weatherData.current.temp + "Â°C ";

        el.style.display = "block";
        statusEl.textContent = "";
      }

      function renderAQI() {
        var el = document.getElementById("aqiDisplay");
        var statusEl = document.getElementById("statusDisplay");

        if (langMode === 2) {
          el.style.display = "none";
          statusEl.textContent = "";
          return;
        }

        if (!aqiData) {
          if (!statusEl.textContent || statusEl.textContent === "") {
            statusEl.textContent =
              langMode === 0
                ? "ë¯¸ì„¸ë¨¼ì§€ ì •ë³´ë¥¼ ì½ì–´ì˜¤ëŠ” ì¤‘..."
                : "Loading AQI...";
          }
          el.style.display = "none";
          return;
        }
        if (aqiData.error) {
          statusEl.textContent =
            langMode === 0 ? aqiData.error.ko : aqiData.error.en;
          el.style.display = "none";
          return;
        }
        var aqiIcon = "ğŸ˜„";
        if (aqiData.todayMax > 40) aqiIcon = "ğŸ˜·";
        if (aqiData.todayMax > 80) aqiIcon = "ğŸ¤¢";
        if (aqiData.todayMax > 100) aqiIcon = "ğŸ‘¿";
        el.textContent =
          "PM2.5 ğŸ˜· " +
          aqiData.current +
          " " +
          aqiIcon +
          " " +
          aqiData.todayMax;
        el.style.display = "block";
        statusEl.textContent = "";
      }

      function toggleLang() {
        langMode = (langMode + 1) % 3;
        updateClock();
        renderWeather();
        renderAQI();
        updateQuote();
      }

      function toggleTimeFormat() {
        is12Hour = !is12Hour;
        updateClock();
      }

      function updateClock() {
        var now = new Date();

        // ì‹œê°„ ì¶”ì¶œ
        var h = now.getHours();
        var m = now.getMinutes();
        var s = now.getSeconds();

        // ë§¤ ì´ˆë§ˆë‹¤ ìƒ‰ìƒ ë³€ê²½ (ë°ì€ ìƒ‰ ê³„ì—´)
        var colors = [
          "#FF80AB",
          "#EA80FC",
          "#8C9EFF",
          "#80D8FF",
          "#A7FFEB",
          "#CCFF90",
          "#FFFF8D",
          "#FFD180",
        ];
        document.getElementsByClassName("time")[0].style.color =
          colors[s % colors.length];

        // 2ìë¦¬ ìˆ«ìë¡œ í¬ë§·
        if (is12Hour) {
          h = h % 12;
          if (h === 0) {
            h = 12; // 0ì‹œëŠ” 12ì‹œë¡œ í‘œì‹œ
          }
        }

        h = h < 10 ? "0" + h : h;
        m = m < 10 ? "0" + m : m;
        s = s < 10 ? "0" + s : s;

        // DOM ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ë¬¸ì œ ì—†ì´ í…ìŠ¤íŠ¸ ë…¸ë“œë§Œ ë³€ê²½)
        document.getElementById("hours").textContent = h;
        document.getElementById("minutes").textContent = m;
        document.getElementById("seconds").textContent = s;

        // ë‚ ì§œ í¬ë§·íŒ…
        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var date = now.getDate();
        var dayIndex = now.getDay();

        // ì˜ì–´ ê¸°ì¤€ ìš”ì¼ ì•„ì´ì½˜
        var dayNames = [
          "ì¼ìš”ì¼",
          "ì›”ìš”ì¼",
          "í™”ìš”ì¼",
          "ìˆ˜ìš”ì¼",
          "ëª©ìš”ì¼",
          "ê¸ˆìš”ì¼",
          "í† ìš”ì¼",
        ];
        var dayNames_en = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];

        // 3ëª¨ë“œ (ì•ˆë³´ì„) ì¼ë•Œ ë‚ ì§œ ì˜ì—­ ìˆ¨ê¸°ê¸°
        var dateDisplayEl = document.getElementById("dateDisplay");
        if (langMode === 2) {
          dateDisplayEl.style.display = "none";
          return; // ë‚ ì§œ ì—…ë°ì´íŠ¸ ì¡°ê¸° ì¢…ë£Œ
        } else {
          dateDisplayEl.style.display = "block";
        }

        // ìš”ì¼ ìƒ‰ìƒ êµ¬í•˜ê¸° (ì¼ìš”ì¼: ë°ì€ ë¹¨ê°•, í† ìš”ì¼: ë°ì€ íŒŒë‘, í‰ì¼: ì´ˆë¡)
        var dayColor = "#52ff52";
        if (dayIndex === 0) {
          dayColor = "#ff5252";
        } else if (dayIndex === 6) {
          dayColor = "#4da8da";
        }

        // ì „ì²´ ê¸€ììƒ‰ ì„¤ì • ì´ˆê¸°í™”
        dateDisplayEl.style.color = "";

        if (langMode === 0) {
          var dayName = dayNames[dayIndex];
          // 0 ì±„ìš°ê¸°
          month = month < 10 ? "0" + month : month;
          date = date < 10 ? "0" + date : date;

          dateDisplayEl.innerHTML =
            year +
            "ë…„ " +
            month +
            "ì›” " +
            date +
            "ì¼ <span style='color:" +
            dayColor +
            "'>" +
            dayName +
            "</span>";
        } else if (langMode === 1) {
          var dayNameEn = dayNames_en[dayIndex];
          var monthNamesEn = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];
          var mEn = monthNamesEn[now.getMonth()];

          dateDisplayEl.innerHTML =
            "<span style='color:" +
            dayColor +
            "'>" +
            dayNameEn +
            "</span>, " +
            mEn +
            " " +
            now.getDate() +
            ", " +
            year;
        }
      }

      function startClock() {
        updateClock();
        // ë¸Œë¼ìš°ì € ë”œë ˆì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì •í™•í•œ 1ì´ˆ(0ë°€ë¦¬ì´ˆ)ê°€ ë˜ëŠ” ìˆœê°„ì„ ê³„ì‚°í•˜ì—¬ ì˜ˆì•½
        var now = new Date();
        var msToNextSecond = 1000 - now.getMilliseconds();
        setTimeout(startClock, msToNextSecond);
      }

      // ì‹œê³„ êµ¬ë™ ì‹œì‘
      startClock();

      // --------------------------------------------------
      // í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸° (Open-Meteo API ì‚¬ìš©)
      // --------------------------------------------------
      function getWeatherIcon(wmoCode) {
        // WMO ë‚ ì”¨ ì½”ë“œ(0~99)ì— ë”°ë¼ ì´ëª¨ì§€ ë°˜í™˜
        // ì°¸ê³ : https://open-meteo.com/en/docs
        if (wmoCode === 0) return "â˜€ï¸"; // ë§‘ìŒ
        if (wmoCode === 1 || wmoCode === 2 || wmoCode === 3) return "â›…"; // êµ¬ë¦„ ì¡°ê¸ˆ~íë¦¼
        if (wmoCode === 45 || wmoCode === 48) return "ğŸŒ«ï¸"; // ì•ˆê°œ
        if (wmoCode >= 51 && wmoCode <= 67) return "ğŸŒ§ï¸"; // ë¹„
        if (wmoCode >= 71 && wmoCode <= 77) return "â„ï¸"; // ëˆˆ
        if (wmoCode >= 80 && wmoCode <= 82) return "ğŸŒ¦ï¸"; // ì†Œë‚˜ê¸°
        if (wmoCode >= 85 && wmoCode <= 86) return "ğŸŒ¨ï¸"; // ëˆˆë³´ë¼
        if (wmoCode >= 95 && wmoCode <= 99) return "â›ˆï¸"; // ë‡Œìš°
        return "â˜ï¸"; // ê¸°ë³¸ê°’
      }

      function fetchWeather(lat, lon) {
        var url =
          "https://api.open-meteo.com/v1/forecast?latitude=" +
          lat +
          "&longitude=" +
          lon +
          "&current_weather=true" +
          "&daily=weathercode,temperature_2m_max,temperature_2m_min" +
          "&timezone=auto" +
          "&past_days=1" +
          "&forecast_days=2";

        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            try {
              var response = JSON.parse(xhr.responseText);
              var temp = response.current_weather.temperature;
              var code = response.current_weather.weathercode;
              var icon = getWeatherIcon(code);

              var yMax = Math.round(response.daily.temperature_2m_max[0]);
              var yIcon = getWeatherIcon(response.daily.weathercode[0]);

              var tMax = Math.round(response.daily.temperature_2m_max[2]);
              var tIcon = getWeatherIcon(response.daily.weathercode[2]);

              weatherData = {
                current: { icon: icon, temp: temp },
                yesterday: { icon: yIcon, max: yMax },
                tomorrow: { icon: tIcon, max: tMax },
              };
              renderWeather();
            } catch (e) {
              weatherData = { error: { ko: "ë‚ ì”¨ ì˜¤ë¥˜", en: "Weather Error" } };
              renderWeather();
            }
          } else if (xhr.readyState === 4) {
            weatherData = {
              error: {
                ko: "ë‚ ì”¨ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                en: "Cannot load weather.",
              },
            };
            renderWeather();
          }
        };
        xhr.send();
      }

      function updateQuote() {
        var messageEl = document.querySelector(".message");
        if (langMode === 2) {
          messageEl.style.display = "none";
          return;
        }

        var titles = [
          "ìµœê³ ì˜ ì˜ˆìœì´ëŠ” ",
          "ìµœê³ ì˜ ìŠ¤í”Œë˜íˆ° ìœ ì €ëŠ” ",
          "ìµœê³ ì˜ ëª»ë‚œì´ëŠ” ",
          "ìµœê³ ì˜ ìš”ë¦¬ì‚¬ëŠ” ",
          "ìµœê³ ì˜ ë°©ê·€ ëŒ€ì¥ì€ ",
        ];
        var names = [
          "ìœ¤ì€ì†” ì…ë‹ˆë‹¤!",
          "ìœ¤ì€ì†” ì…ë‹ˆë‹¤!",
          "ì´ë¯¼ì • ì…ë‹ˆë‹¤!",
          "ìœ¤ì—¬ì • ì…ë‹ˆë‹¤!",
          "ìš°ë¦¬ ëª¨ë‘ ì…ë‹ˆë‹¤!",
        ];

        // ë§¤ í˜¸ì¶œë§ˆë‹¤ ì™„ì „ ëœë¤ìœ¼ë¡œ ë½‘ê¸°
        var randTitle = titles[Math.floor(Math.random() * titles.length)];
        var randName = names[Math.floor(Math.random() * names.length)];

        var randomString = randTitle + randName;

        messageEl.style.display = "block";
        messageEl.textContent = randomString;
      }

      function updateWeather() {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              var lat = position.coords.latitude;
              var lon = position.coords.longitude;
              fetchWeather(lat, lon);
            },
            function (error) {
              console.error("ìœ„ì¹˜ ì •ë³´ ê±°ë¶€ë¨ ë˜ëŠ” ì—ëŸ¬:", error);
              weatherData = {
                error: {
                  ko: "ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.",
                  en: "Location access required.",
                },
              };
              renderWeather();
            },
          );
        } else {
          weatherData = {
            error: {
              ko: "ìœ„ì¹˜ ì •ë³´ê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê¸°ê¸°ì…ë‹ˆë‹¤.",
              en: "Location not supported.",
            },
          };
          renderWeather();
        }
      }

      // í˜ì´ì§€ ì§„ì… ì‹œ ë‚ ì”¨/ë¯¸ì„¸ë¨¼ì§€/ìš´ì„¸ 1íšŒ ì—…ë°ì´íŠ¸ ë° 30ë¶„ë§ˆë‹¤ ê°±ì‹ 
      updateWeather();
      updateAQI();
      updateQuote();
      setInterval(function () {
        updateWeather();
        updateAQI();
        updateQuote();
      }, 1800000);
      // êµ¬ë²„ì „ ë° ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ëŠ” ìì—°íˆ ë¬´ì‹œ
      // --------------------------------------------------
      var wakeLock = null;
      async function requestWakeLock() {
        if ("wakeLock" in navigator) {
          try {
            wakeLock = await navigator.wakeLock.request("screen");

            // í™”ë©´/íƒ­ ë³€ê²½ í›„ ëŒì•„ì˜¬ ë•Œ Lockì´ í’€ë¦¬ëŠ” ê²ƒ ë°©ì§€
            document.addEventListener("visibilitychange", async function () {
              if (wakeLock !== null && document.visibilityState === "visible") {
                wakeLock = await navigator.wakeLock.request("screen");
              }
            });
          } catch (err) {
            console.log("Wake Lock Error:", err);
          }
        }
      }
      // ë¯¸ì„¸ë¨¼ì§€
      function updateAQI() {
        var token = "c1611aa54ac7de2320cc3105b7b42a0ba2b26447";
        // 'here'ëŠ” IP ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.
        var url = "https://api.waqi.info/feed/here/?token=" + token;

        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            try {
              var response = JSON.parse(xhr.responseText);
              if (response.status === "ok") {
                var currentAqi = response.data.aqi;
                var todayMax = "-";
                var tomorrowMax = "-";

                // ì˜¤ëŠ˜ ì˜ˆë³´ (ìµœê³ ) ê°€ì ¸ì˜¤ê¸°
                if (
                  response.data.forecast &&
                  response.data.forecast.daily &&
                  response.data.forecast.daily.pm25
                ) {
                  var forecasts = response.data.forecast.daily.pm25;
                  var now = new Date();
                  var year = now.getFullYear();
                  var month = now.getMonth() + 1;
                  var day = now.getDate();
                  if (month < 10) month = "0" + month;
                  if (day < 10) day = "0" + day;
                  var todayStr = year + "-" + month + "-" + day;

                  var tomorrow = new Date(now);
                  tomorrow.setDate(tomorrow.getDate() + 1);
                  var tYear = tomorrow.getFullYear();
                  var tMonth = tomorrow.getMonth() + 1;
                  var tDay = tomorrow.getDate();
                  if (tMonth < 10) tMonth = "0" + tMonth;
                  if (tDay < 10) tDay = "0" + tDay;
                  var tomorrowStr = tYear + "-" + tMonth + "-" + tDay;

                  for (var i = 0; i < forecasts.length; i++) {
                    if (forecasts[i].day === todayStr) {
                      todayMax = forecasts[i].max;
                    }
                    if (forecasts[i].day === tomorrowStr) {
                      tomorrowMax = forecasts[i].max;
                    }
                  }
                }

                aqiData = {
                  current: currentAqi,
                  todayMax: todayMax,
                  tomorrowMax: tomorrowMax,
                };
                renderAQI();
              }
            } catch (e) {
              console.log("AQI Error:", e);
              aqiData = { error: { ko: "ë¯¸ì„¸ë¨¼ì§€ ì˜¤ë¥˜", en: "AQI Error" } };
              renderAQI();
            }
          } else if (xhr.readyState === 4) {
            aqiData = {
              error: {
                ko: "ë¯¸ì„¸ë¨¼ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                en: "Cannot load AQI.",
              },
            };
            renderAQI();
          }
        };
        xhr.send();
      }
    </script>
  </body>
</html>
